<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="/static/favicon.png">
       
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/modal.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏ flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>      
    <title>Admin Page</title>
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —Ç–∞–±–ª–∏—Ü—ã */
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
      
        .container {
            width: auto; /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            min-width: 400px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞, –µ—Å–ª–∏ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã —Å–∫—Ä—ã—Ç—ã */
            max-width: 80%; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ —à–∏—Ä–∏–Ω–µ */
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow-x: auto; /* –î–æ–±–∞–≤–ª—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É, –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }

        h1 {
            font-size: 20px;
            margin-bottom: 10px;
            text-align: center;
            color: #333;
        }
        
       
       /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 10px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —à—Ä–∏—Ñ—Ç */
            margin-top: 8px;
          
           /* table-layout: auto; /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ */
        }


        th, td {
            border: 1px solid #ddd;
            padding: 4px;
            text-align: left;
            white-space: nowrap; /* –ò—Å–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Ç–µ–∫—Å—Ç–∞ */
        }

        thead input[type="text"] {
            width: calc(100% - 8px); /* –ü–æ–ª—è –≤–≤–æ–¥–∞ –∑–∞–Ω–∏–º–∞—é—Ç —à–∏—Ä–∏–Ω—É –¥–∞–Ω–Ω—ã—Ö —Å —É—á—ë—Ç–æ–º –æ—Ç—Å—Ç—É–ø–æ–≤ */
            max-width: 210px; /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É */
            box-sizing: border-box; /* –£—á–∏—Ç—ã–≤–∞–µ–º padding –∏ border */
            padding: 4px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ */
            font-size: 10px; /* –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ */
            margin: 0; /* –£–±–∏—Ä–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
        }


        /* –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ */
        #header-user_index,
        #header-user_sex,
        #header-account_status, 
        #header-birth {
            max-width: 65px; /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã */
        }

        /* –î–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª–µ–π –ø–æ–∏—Å–∫–∞ */
        thead input[data-column="user_index"],
        thead input[data-column="user_sex"],
        thead input[data-column="account_status"],
        thead input[data-column="birth"] {
            max-width: 60px; /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏ */
        }

        thead th {
            position: relative; /* –î–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —è—á–µ–µ–∫ */
            padding: 4px; /* –°—É–∂–∞–µ–º padding */
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
            white-space: nowrap; /* –¢–µ–∫—Å—Ç –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ */
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }



        .date-range {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .date-range input[type="date"] {
        width: 150px;
    }

    .date-range span {
        margin: 0 5px;
    }

        .delete-icon, .toggle-status-icon  {
            cursor: pointer;
            color: #ff4d4d;
            font-size: 16px; 
        }
        .delete-icon:hover {
            color: #cc0000;
        }

         /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
         .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination button {
            margin: 0 5px;
            padding: 5px 10px;
        }
                /* –°—Ç–∏–ª–∏ –¥–ª—è —è—á–µ–µ–∫ —Å COR-ID */
        .cor-id-cell {
            cursor: pointer; /* –£–∫–∞–∑–∞—Ç–µ–ª—å –º—ã—à–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            text-decoration: none; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }

        /* –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .cor-id-cell:hover {
            text-decoration: underline; /* –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            color: blue; /* –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Å–∏–Ω–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
        }
        .activity-indicator {
            background-color: #ccc; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ */
            border-radius: 50%; /* –î–µ–ª–∞–µ–º –∫—Ä—É–≥–ª—ã–π */
            width: 15px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–∏–∞–º–µ—Ç—Ä */
            height: 15px; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–∏–∞–º–µ—Ç—Ä */
            margin-left: 3px; /* –û—Ç—Å—Ç—É–ø –¥–ª—è –æ—Ç–¥–µ–ª–µ–Ω–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
            border: 2px solid #fff; /* –ë–µ–ª–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –±–æ–ª–µ–µ —á–µ—Ç–∫–æ–≥–æ –≤–∏–¥–∏–º–æ–≥–æ –∫—Ä—É–≥–∞ */
        }

    </style>
</head>
<body>
    <div class="container">
        <button class="link-button" onclick="goBack()" data-translate="back-link-text"><<<–Ω–∞–∑–∞–¥<<<</button>
        <h1>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h1>
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ --> 
<div id="columnSelectModal" class="modal" style="display: none;">
    <div class="modal-header">
        <h1>–ü–æ–ª—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è </h1>
        <div class="modal-buttons">
            <button class="modal-button close" data-action="close" id="closeColumnSelectModal">‚úñ</button>
        </div>
    </div>
        <label><input type="checkbox" onchange="toggleColumn('user_index')" id="checkbox-user_index" checked >–ò–Ω–¥–µ–∫—Å</label><br>
        <label><input type="checkbox" onchange="toggleColumn('id')" id="checkbox-id" checked >ID</label><br>
        <label><input type="checkbox" onchange="toggleColumn('cor_id')" id="checkbox-cor_id" checked >COR-ID</label><br>
        <label><input type="checkbox" onchange="toggleColumn('user_sex')" id="checkbox-user_sex" checked >–ü–æ–ª</label><br>
        <label><input type="checkbox" onchange="toggleColumn('birth')" id="checkbox-birth" checked >–ì–æ–¥ —Ä–æ–∂.</label><br>
        <label><input type="checkbox" onchange="toggleColumn('email')" id="checkbox-email" checked >Email</label><br>
        <label><input type="checkbox" onchange="toggleColumn('created_at')" id="checkbox-created_at" checked >–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</label><br>
        <label><input type="checkbox" onchange="toggleColumn('last_password_change')" id="checkbox-last_password_change" checked >–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label><br>
        <label><input type="checkbox" onchange="toggleColumn('last_active')" id="checkbox-last_active" checked >–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label><br>
   
    <div class="modal-footer" style="text-align: center; margin-top: 20px;">
        <button onclick="closeModal('columnSelectModal')" class="modal-button">–û–ö</button>
    </div>
</div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ COR-ID -->
        <div id="corIdModal" class="modal">
            <div class="modal-header">
                <div class="modal-title">
                    <h1>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ COR-ID:</h1>
                    <span id="corIdValue"></span>
                </div>
                <div class="modal-buttons">
                    <button class="modal-button close" data-action="close" id="closeCorIDModal">‚úñ</button>
                </div>
            </div>
            
                <div id="corIdInfo">
                    <!-- –ó–¥–µ—Å—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ COR-ID -->               
                </div>
                <div id="qrcode"></div>
           
            <div class="modal-footer">
                <button class="modal-button" onclick="closeCorIdModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

   <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏ –∏—Å—Ç—ë–∫ -->
<div id="tokenExpiredModal" class="modal" style="display: none;">
    <div class="modal-header">
        <h1>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏ –∏—Å—Ç—ë–∫</h1>
        <div class="modal-buttons">
            <button class="modal-button close" id="closeTokenExpiredModal">‚úñ</button>
        </div>
    </div>
    <div class="modal-content">
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</p>
    </div>
    <div class="modal-footer">
        <button id="loginRedirectButton" class="modal-button">–í–æ–π—Ç–∏</button>
    </div>
</div>


<button id="openModalBtn">–í—ã–±—Ä–∞—Ç—å –≤—ã–≤–æ–¥</button>
        <!-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
        <table id="userTable">
            <thead>
                <tr>
                    <th id="header-user_index">–ò–Ω–¥–µ–∫—Å<br><input type="text" oninput="filterTable()" data-column="user_index"></th>
                    <th id="header-id">ID<br><input type="text" oninput="filterTable()" data-column="id"></th>
                    <th id="header-cor_id">COR-ID<br><input type="text" oninput="filterTable()" data-column="cor_id"></th>
                    <th id="header-user_sex">–ü–æ–ª<br><input type="text" oninput="filterTable()" data-column="user_sex"></th>
                    <th id="header-birth">–ì–æ–¥ —Ä–æ–∂–¥.<br><input type="text" oninput="filterTable()" data-column="birth"></th>
                    <th id="header-email">Email<br><input type="text" oninput="filterTable()" data-column="email"></th>
                    <th id="header-created_at">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏<br><input type="text" oninput="filterTable()" data-column="created_at"></th>
                    <th id="header-last_password_change">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º. –ø–∞—Ä–æ–ª—è<br><input type="text" oninput="filterTable()" data-column="last_password_change"></th>
                 <!--   <th id="header-last_active">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å<br><input type="text" oninput="filterTable()" data-column="last_active"></th> -->
                    <th id="header-last_active">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å<br>
                      <div class="date-range">
                        <input type="text" id="dateRangeActive" onchange="filterByDateRange()" placeholder="–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç">
                      </div>
                    </th> 
                    <th id="header-account_status">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞<br><input type="text" oninput="filterTable()" data-column="account_status"></th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                   
                </tr>
        
            </thead>
            <tbody>
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            </tbody>
        </table>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        <div class="pagination" id="pagination">
            <button onclick="goToFirstPage()">¬´ –ü–µ—Ä–≤—ã–π</button>
            <button onclick="prevPage()">¬´ –ù–∞–∑–∞–¥</button>
            <span id="page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span> <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
            <button onclick="nextPage()">–í–ø–µ—Ä–µ–¥ ¬ª</button>
            <button onclick="goToLastPage()">–ü–æ—Å–ª–µ–¥–Ω–∏–π ¬ª¬ª</button>
        </div>
    </div>
    <script src="/static/translation.js"></script>
    <script src="/static/general_fun.js"></script>
    <script> function goBack() { window.history.back();  } </script>

    
    <script> 

        let currentPage = 1;
        let rowsPerPage = 5;
        let totalRows = 0;

        
        let allFilteredUsers = []; // –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        let isFiltering = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function populateTable(users) {
            console.log("–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:", users); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            const tbody = document.querySelector('#userTable tbody');
            tbody.innerHTML = ''; // –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º

            users.forEach(user => {
                const row = document.createElement('tr');

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏
              // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–Ω–∏—Ü—É –≤–æ –≤—Ä–µ–º–µ–Ω–∏
                const currentTime = new Date();
                const lastActiveTime = user.last_active ? new Date(user.last_active) : null;
                const timeDiff = lastActiveTime ? (currentTime - lastActiveTime) / (1000 * 60 * 60) : null; // –†–∞–∑–Ω–∏—Ü–∞ –≤ —á–∞—Å–∞—Ö

                const activityTitle = lastActiveTime
                ? (timeDiff >= 1 
                    ? `${Math.floor(timeDiff)} —á ${Math.floor((timeDiff % 1) * 60)} –º–∏–Ω –Ω–∞–∑–∞–¥` // –ß–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã
                    : `${Math.floor(timeDiff * 60)} –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥`) // –¢–æ–ª—å–∫–æ –º–∏–Ω—É—Ç—ã
                    : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';

                let activityColor = 'gray'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Å–µ—Ä—ã–π

                if (timeDiff !== null) {
                    if (timeDiff <= 24) {
                        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ —Ü–≤–µ—Ç–∞ (–æ—Ç 0 –¥–æ 1)
                        const gradientFactor = timeDiff / 24;

                        // –í—ã—á–∏—Å–ª—è–µ–º —Ü–≤–µ—Ç –æ—Ç –∑–µ–ª—ë–Ω–æ–≥–æ (0, 255, 0) –∫ –∫—Ä–∞—Å–Ω–æ–º—É (255, 0, 0)
                        const red = Math.round(gradientFactor * 255); // –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏
                        const green = Math.round((1 - gradientFactor) * 255); // –£–º–µ–Ω—å—à–∞–µ—Ç—Å—è —Å —Ç–µ—á–µ–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏
                        activityColor = `rgb(${red}, ${green}, 0)`; // –ü–æ–ª—É—á–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π —Ü–≤–µ—Ç
                    }
                }


                row.innerHTML = `
                ${document.getElementById('header-user_index').style.display !== 'none' ? `<td>${user.user_index}</td>` : ''}
                ${document.getElementById('header-id').style.display !== 'none' ? `<td>${user.id}</td>` : ''}
                ${document.getElementById('header-cor_id').style.display !== 'none' ? `<td class="cor-id-cell">${user.cor_id}</td>` : ''}
                ${document.getElementById('header-user_sex').style.display !== 'none' ? `<td>${user.user_sex}</td>` : ''}
                ${document.getElementById('header-birth').style.display !== 'none' ? `<td>${user.birth}</td>` : ''}
                ${document.getElementById('header-email').style.display !== 'none' ? `<td>${user.email}</td>` : ''}
                ${document.getElementById('header-created_at').style.display !== 'none' ? `<td>${new Date(user.created_at).toLocaleString()}</td>` : ''}
                ${document.getElementById('header-last_password_change').style.display !== 'none' ? `<td>${new Date(user.last_password_change).toLocaleString()}</td>` : ''}      
                ${document.getElementById('header-last_active').style.display !== 'none' ? `<td>${new Date(user.last_active).toLocaleString()}</td>` : ''} 
                    <td> <select onchange="confirmStatusChange('${user.email}', this.value)">
                            <option value="basic" ${user.account_status === 'basic' ? 'selected' : ''}>basic</option>
                            <option value="premium" ${user.account_status === 'premium' ? 'selected' : ''}>premium</option>
                        </select>
                    </td>
                    <td> <span class="delete-icon" onclick="deleteUser('${user.email}')">üóëÔ∏è</span>
                        <span class="toggle-status-icon" onclick="toggleUserStatus('${user.email}', ${user.is_active ?? true})">
                         ${user.is_active !== false ? 'üîì' : 'üîí'}
                             </span>
                            
                             <span class="activity-indicator" style="background: ${activityColor}; display: inline-block; width: 12px; height: 12px;" title="–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${activityTitle}">
        </span>
                    </td>
                `;

                tbody.appendChild(row);
            });

             // –ü–æ–¥–≥–æ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
            adjustContainerWidth();
          //  adjustColumnWidths();
        }

        

async function getAllUsers(skip = 0, limit = rowsPerPage) {
    const accessToken = new URLSearchParams(window.location.search).get('access_token');
    const url = `/api/admin/get_all?skip=${skip}&limit=${limit}`;
    
    console.log('–ó–∞–ø—Ä–æ—Å URL:', url); // –õ–æ–≥–∏—Ä—É–µ–º URL –∑–∞–ø—Ä–æ—Å–∞
    console.log('–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞:', accessToken); // –õ–æ–≥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ (—É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏!)

    try {
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken
            }
        });

        console.log('HTTP –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞:', response.status); // –õ–æ–≥–∏—Ä—É–µ–º HTTP —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞

        if (!response.ok) {
            throw new Error(`–û—à–∏–±–∫–∞: ${response.status} ${response.statusText}`);
        }

        const data = await response.json();
        console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:', JSON.stringify(data, null, 2));
       
        const users = Array.isArray(data) ? data : []; 

        console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–π—Å—Ç–≤–∞ users:', users);
       

        if (users.length > 0) {
            console.log('–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:', users); // –õ–æ–≥–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            populateTable(users); // –ü–µ—Ä–µ–¥–∞—ë–º –º–∞—Å—Å–∏–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            adjustContainerWidth(); // –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–∑–º–µ—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
           // adjustColumnWidths();
            return users; // –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã
        } else {
            console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.');
            return false; // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error); // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É
        return false;
    }
}
          // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          async function deleteUser(email) {
            const accessToken = new URLSearchParams(window.location.search).get('access_token');
            const url = `/api/admin/${email}`;

            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å email: ${email}?`)) {
                try {
                    const response = await fetch(url, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + accessToken
                        }
                    });

                    if (response.ok) {
                        alert(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω.`);
                        getAllUsers(); // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
                    } else {
                        const errorData = await response.json();
                        alert(`–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${errorData.message || response.statusText}`);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.');
                }
            }
        }


        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function confirmStatusChange(email, newStatus) {
            const confirmChange = confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å email: ${email} –Ω–∞ ${newStatus}?`);

            if (!confirmChange) return;

            const accessToken = new URLSearchParams(window.location.search).get('access_token');
            const url = `/api/admin/asign_status/${newStatus}?email=${encodeURIComponent(email)}`;

            try {
                const response = await fetch(url, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + accessToken
                    }
                });

                if (response.ok) {
                    alert(`–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${email} —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ ${newStatus}.`);
                    getAllUsers(); // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
                } else {
                    const errorData = await response.json();
                    alert(`–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${errorData.message || response.statusText}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.');
            }
        }


 // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏—é/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
 async function toggleUserStatus(email, isActive) {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ accessToken –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
    const accessToken = new URLSearchParams(window.location.search).get('access_token');
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ accessToken
    if (!accessToken) {
        alert("–¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL.");
        return;
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ URL –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞ isActive
    const url = isActive 
        ? `/api/admin/deactivate/${encodeURIComponent(email)}` 
        : `/api/admin/activate/${encodeURIComponent(email)}`;

    try {
        const response = await fetch(url, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + accessToken
            }
        });
        
        const result = await response.json();

        if (response.ok) {
            alert(result.message);
            getAllUsers(); // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        } else {
            alert(`–û—à–∏–±–∫–∞: ${result.message}`);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.');
    }
}

async function filterTable() {
    if (isFiltering) {
        console.log("–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –æ—Ç–º–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞");
        return;
    }
    isFiltering = true;

    // –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
    const filters = {};
    document.querySelectorAll('thead input[type="text"]').forEach(input => {
        const column = input.getAttribute('data-column');
        const value = input.value.trim().toLowerCase();
        if (value) {
            filters[column] = value; // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ñ–∏–ª—å—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –Ω–µ–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        }
    });

    console.log("–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:", filters);

    allFilteredUsers = [];
    let skip = 0;
    let hasMoreData = true;

    while (hasMoreData) {
        console.log(`–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–ø—É—Å–∫–æ–º: ${skip}, –ª–∏–º–∏—Ç: ${rowsPerPage}`);
        const users = await getAllUsers(skip, rowsPerPage);

        if (Array.isArray(users) && users.length > 0) {
            console.log(`–ü–æ–ª—É—á–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}`);
            const filteredUsers = users.filter(user => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                return Object.keys(filters).every(column => {
                    return user[column]?.toString().toLowerCase().includes(filters[column]);
                });
            });

            console.log(`–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${filteredUsers.length}`);
            allFilteredUsers = allFilteredUsers.concat(filteredUsers);
            skip += rowsPerPage;
        } else {
            hasMoreData = false;
            console.log("–ù–µ—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö");
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    populateTable(allFilteredUsers.slice(0, rowsPerPage));
    isFiltering = false;
}
  
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updatePageInfo() {
            document.getElementById('page-info').innerText = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${currentPage}`;
        }


        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            async function nextPage() {
                const skip = currentPage * rowsPerPage;
                const dataAvailable = await getAllUsers(skip, rowsPerPage);

                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º currentPage, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã
                if (dataAvailable) {
                    currentPage++;
                    updatePageInfo();
                }
            }

            // –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            function prevPage() {
                if (currentPage > 1) {
                    currentPage--;
                    updatePageInfo();
                    const skip = (currentPage - 1) * rowsPerPage;
                    getAllUsers(skip, rowsPerPage); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                }
            }


        function goToFirstPage() {
            currentPage = 1;
            updatePageInfo();
            loadPage();
        }

        async function goToLastPage() {
            let totalUsers = 0; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

            // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ
            let skip = 0;
            let hasMoreData = true;

            while (hasMoreData) {
                console.log(`–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–ø—É—Å–∫–æ–º: ${skip}, –ª–∏–º–∏—Ç: ${rowsPerPage}`);
                const users = await getAllUsers(skip, rowsPerPage); // –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

                if (Array.isArray(users) && users.length > 0) {
                    totalUsers += users.length; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    skip += rowsPerPage; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–æ–ø—É—Å–∫ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
                } else {
                    hasMoreData = false; // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º —Ü–∏–∫–ª, –µ—Å–ª–∏ –Ω–µ—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
                    console.log("–ù–µ—Ç –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö");
                }
            }

            // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
            const totalPages = Math.ceil(totalUsers / rowsPerPage);
            currentPage = totalPages; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é

            updatePageInfo(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            loadPage(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        }

        function loadPage() {
            const skip = (currentPage - 1) * rowsPerPage;
            getAllUsers(skip, rowsPerPage);
        }

                // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            function openModal() {
                document.getElementById("corIdModal").style.display = "block";
                
            }

            function closeCorIdModal() {
                document.getElementById("corIdModal").style.display = "none";
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            function closeModal() {
                document.getElementById('columnSelectModal').style.display = 'none';
            }


                    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('closeCorIDModal').addEventListener('click', function() {
                document.getElementById('corIdModal').style.display = 'none';
            });
            document.addEventListener('DOMContentLoaded', function () {
           const tableBody = document.querySelector("#userTable tbody");

                // –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–æ–±—ã—Ç–∏—è –Ω–∞ —è—á–µ–π–∫–∏ —Å COR-ID
                tableBody.addEventListener('click', function (event) {
                    if (event.target && event.target.classList.contains('cor-id-cell')) {
                        const corId = event.target.textContent;
                        showCorIdInfo(corId);
                    }
                });
            });

            function showCorIdInfo(corId) {
            const accessToken = new URLSearchParams(window.location.search).get('access_token');
            if (!accessToken) {
                console.error('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }

                fetch("/api/medical/cor_id/show_corid_info", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${accessToken}`
                    },
                    body: JSON.stringify({ cor_id: corId })
                })
                .then(response => {
                    if (!response.ok) {
                        console.error('–û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', response.statusText);
                        throw new Error("COR-Id –Ω–µ –Ω–∞–π–¥–µ–Ω");
                    }
                    return response.json();
                })
                .then(data => {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–Ω–µ–π –≤ –¥–∞—Ç—É
                    const baseDate = new Date(2024, 0, 1); // 1 —è–Ω–≤–∞—Ä—è 2024 –≥–æ–¥–∞
                    const registrationDate = new Date(baseDate);
                    registrationDate.setDate(baseDate.getDate() + data.n_days_since);

                    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
                    const options = { year: 'numeric', month: 'long', day: 'numeric' };
                    const formattedDate = registrationDate.toLocaleDateString('ru-RU', options);

                    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
                    document.getElementById("corIdValue").textContent = corId;
                    const corIdInfo = `
                        <p>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${formattedDate}</p>
                        <p>–ù–æ–º–µ—Ä —É—á—Ä–µ–∂–¥–µ–Ω–∏—è: ${data.facility_number}</p>
                        <p>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ –¥–µ–Ω—å: ${data.register_per_day}</p>
                        <p>–ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è: ${data.birth_year}</p>
                        <p>–ü–æ–ª: ${data.gender}</p>
                        <p>–í–µ—Ä—Å–∏—è: ${data.version}</p>
                    `;
                    document.getElementById("corIdInfo").innerHTML = corIdInfo;
                    openModal();

                    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
                    generateQrCodeFromText(corId); // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞
                })
                .catch(error => {
                    console.error("–û—à–∏–±–∫–∞:", error);
                    alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ COR-ID");
                });
            }

 
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
            function toggleColumn(column) {
                const header = document.getElementById(`header-${column}`);
                const isVisible = header.style.display !== 'none';
                
                // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏
                header.style.display = isVisible ? 'none' : '';
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage
                const columnState = JSON.parse(localStorage.getItem('columnsState') || '{}');
                columnState[column] = !isVisible; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏
                localStorage.setItem('columnsState', JSON.stringify(columnState));
                console.log('–ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage:', columnState);
                initializeCheckboxes();
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —è—á–µ–µ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                const cells = document.querySelectorAll(`tbody td:nth-child(${Array.from(header.parentNode.children).indexOf(header) + 1})`);
                cells.forEach(cell => {
                    cell.style.display = header.style.display;
                });

                loadPage(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

                // –ü–æ–¥–≥–æ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
                adjustContainerWidth();
              //  adjustColumnWidths();
            }
                    
           // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ localStorage
            function initializeColumns() {
                const columnState = JSON.parse(localStorage.getItem('columnsState') || '{}');

                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏
                Object.keys(columnState).forEach(column => {
                    const header = document.getElementById(`header-${column}`);
                    if (header) {
                        const isVisible = columnState[column];
                        header.style.display = isVisible ? '' : 'none'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å

                        // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å —è—á–µ–µ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ
                        const cells = document.querySelectorAll(`tbody td:nth-child(${Array.from(header.parentNode.children).indexOf(header) + 1})`);
                        cells.forEach(cell => {
                            cell.style.display = header.style.display;
                        });
                    }
                });
            }

  
                function initializeCheckboxes() {
                    const columnState = JSON.parse(localStorage.getItem('columnsState') || '{}');
                    console.log('–°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ localStorage:', columnState);

                    // –ü—Ä–æ–±–µ–≥–∞–µ–º—Å—è –ø–æ –≤—Å–µ–º —á–µ–∫–±–æ–∫—Å–∞–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    const checkboxes = document.querySelectorAll('#columnSelectModal input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        const columnId = checkbox.id.replace('checkbox-', ''); // –ò–∑–≤–ª–µ–∫–∞–µ–º ID –∫–æ–ª–æ–Ω–∫–∏ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
                        console.log('ID –∫–æ–ª–æ–Ω–∫–∏:', columnId);

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
                        if (columnState[columnId] !== undefined) {
                            checkbox.checked = columnState[columnId];
                            console.log(`–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è ${columnId}: ${columnState[columnId]}`);
                        } else {
                            console.log(`–ù–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è ${columnId}, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é`);
                        }
                    });
                }

       
                function generateQrCodeFromText(corId) {
                    const qrCodeDiv = document.getElementById("qrcode"); // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å ID 'qrcode'
                    if (!qrCodeDiv) {
                        console.error("–≠–ª–µ–º–µ–Ω—Ç —Å ID 'qrcode' –Ω–µ –Ω–∞–π–¥–µ–Ω.");
                        return;
                    }

                    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ QR-–∫–æ–¥–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ
                    qrCodeDiv.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–π QR-–∫–æ–¥
                    new QRCode(qrCodeDiv, {
                        text: corId,
                        width: 200,
                        height: 200
                    });
                }

                function adjustContainerWidth() {
                const table = document.querySelector('table');
                const container = document.querySelector('.container');
                if (table && container) {
                    container.style.minWidth = `${table.offsetWidth}px`;
                }
            }

            function adjustColumnWidths() {
                const columnsToAdjust = ["user_index", "user_sex", "birth"];
                columnsToAdjust.forEach(column => {
                    const header = document.getElementById(`header-${column}`);
                    if (header) {
                        const cells = Array.from(document.querySelectorAll(`tbody td:nth-child(${Array.from(header.parentNode.children).indexOf(header) + 1})`));
                        const maxWidth = Math.max(
                            header.offsetWidth,
                            ...cells.map(cell => cell.scrollWidth)
                        );

                        header.style.width = `${maxWidth}px`; // –ü–æ–¥–≥–æ–Ω—è–µ–º —à–∏—Ä–∏–Ω—É –∑–∞–≥–æ–ª–æ–≤–∫–∞
                        header.style.maxWidth = `${maxWidth}px`; // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É
                        cells.forEach(cell => {
                            cell.style.width = `${maxWidth}px`; // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ —è—á–µ–π–∫–∞–º
                            cell.style.maxWidth = `${maxWidth}px`; // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
                        });
                    }
                });
            }


            function decodeToken(token) {
                try {
                    const payloadBase64 = token.split('.')[1]; // –í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å JWT ‚Äî —ç—Ç–æ payload
                    const payload = atob(payloadBase64); // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∏–∑ base64
                    return JSON.parse(payload); // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º JSON-—Å—Ç—Ä–æ–∫—É –≤ –æ–±—ä–µ–∫—Ç
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:", error);
                    return null;
                }
            }

            function isTokenExpired(token) {
                const payload = decodeToken(token);
                if (payload && payload.exp) {
                    const currentTime = Math.floor(Date.now() / 1000); // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                    return currentTime > payload.exp; // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è
                }
                return true; // –ï—Å–ª–∏ –Ω–µ—Ç exp –∏–ª–∏ –æ—à–∏–±–∫–∞, —Å—á–∏—Ç–∞–µ–º —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫—à–∏–º
            }


            function showTokenExpiredModal() {

                // –û—á–∏—â–∞–µ–º –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ body
                document.body.innerHTML = "";
               // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ CSS, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
               /*
                if (!document.querySelector('link[href="/static/modal.css"]')) {
                    const link = document.createElement("link");
                    link.rel = "stylesheet";
                   // link.href = "modal.css";
                    link.href="/static/modal.css"
                    document.head.appendChild(link);
                }
                    */
                // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
                const modalHTML = `
                    <div id="tokenExpiredModal" style="
                    display: flex;
                    flex-direction: column;
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 400px;
                    background: #f9f9f9;
                    border: 1px solid #979292;
                    border-radius: 5px;
                    z-index: 1000;
                    font-size: 12px;
                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
                ">
                    <div style="
                        background-color: #0078d7;
                        color: white;
                        padding: 5px 10px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-top-left-radius: 5px;
                        border-top-right-radius: 5px;
                    ">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="
                                width: 20px;
                                height: 20px;
                                background-color: yellow;
                                color: black;
                                font-weight: bold;
                                font-size: 16px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                border-radius: 50%;
                            ">!</div>
                            <h1 style="
                                font-size: 14px;
                                margin: 0;
                            ">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Å–µ—Å—Å–∏–∏ –∏—Å—Ç—ë–∫</h1>
                        </div>
                    </div>
                    <div style="
                        padding: 10px;
                        text-align: center;
                    ">
                        <p style="margin: 0 0 20px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.</p>
                        <button id="loginRedirectButton" style="
                            background-color: #007bff;
                            color: white;
                            border: none;
                            border-radius: 5px;
                            padding: 10px 20px;
                            margin: 5px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: background-color 0.3s, transform 0.2s;
                            white-space: nowrap;
                            min-width: 80px;
                            display: inline-flex;
                            align-items: center;
                            justify-content: center;
                        ">–í–æ–π—Ç–∏</button>
                    </div>
                </div>
                    `;
                document.body.style.display = "none";
                document.body.innerHTML = modalHTML;
                document.body.style.display = "block"; 

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
                document.getElementById('loginRedirectButton').addEventListener('click', () => {
                    window.location.href = "/"; 
                });

              //  const modal = document.getElementById('tokenExpiredModal');
              //  modal.style.display = 'block';
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç (–∫–∞–ª–µ–Ω–¥–∞—Ä–∏–∫)
                document.addEventListener('DOMContentLoaded', () => {
                    const dateInputs = document.querySelectorAll('input[id*="Range"]');
                    dateInputs.forEach(input => {
                        input.addEventListener('focus', () => {
                            // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –≤—ã–±—Ä–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç
                            const datePicker = new flatpickr(input, {
                                mode: "range", 
                                dateFormat: "Y-m-d",
                                onClose: function(selectedDates) {
                                    // –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –µ–≥–æ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                                    if (selectedDates.length === 2) {
                                        input.value = `${selectedDates[0].toLocaleDateString()} - ${selectedDates[1].toLocaleDateString()}`;
                                    }
                                }
                            });
                        });
                    });
                });


        // –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
             document.addEventListener('DOMContentLoaded', function() {
             console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
             initializeColumns();
             initializeCheckboxes();
             adjustContainerWidth(); // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
          //   adjustColumnWidths();
             makeModalDraggable('columnSelectModal');
             makeModalDraggable('corIdModal');
         

             const accessToken = new URLSearchParams(window.location.search).get('access_token');

            if (!accessToken || isTokenExpired(accessToken)) {
                showTokenExpiredModal();

            }


            const originalFetch = window.fetch;
            window.fetch = async function (...args) {
                // –ü–µ—á–∞—Ç–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤—ã–∑–æ–≤–∞ fetch –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
                console.log("Fetch arguments:", args);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
                const requestOptions = args[1] || {};
                const headers = requestOptions.headers || {};

                if (headers.Authorization) {
                    const token = headers.Authorization.replace("Bearer ", ""); // –£–±–∏—Ä–∞–µ–º "Bearer"
                    console.log("Extracted token:", token);

                    // –ü–∞—Ä—Å–∏–º —Ç–æ–∫–µ–Ω –∏ –≤—ã–≤–æ–¥–∏–º –µ–≥–æ –≤ –∫–æ–Ω—Å–æ–ª—å
                    const decodedToken = decodeToken(token);
                    if (decodedToken) {
                        console.log("Decoded token:", decodedToken);

                        // –í—ã—á–∏—Å–ª—è–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
                        const remainingTime = calculateTokenLifetime(decodedToken);
                        if (remainingTime !== null) {
                            console.log(`–û—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞: ${remainingTime} —Å–µ–∫—É–Ω–¥`);
                            console.log(`–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è: ${formatTime(remainingTime)}`);
                        }
                    } else {
                        console.error("Failed to decode token.");
                    }
                } else {
                    console.warn("Authorization header is missing.");
                }

                // –í—ã–ø–æ–ª–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
                const response = await originalFetch(...args);

                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫–∏ 401
                if (response.status === 401) { // –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                    console.warn("Unauthorized: Token might be expired.");
                    showTokenExpiredModal();
                }

                return response;
            };

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞
function calculateTokenLifetime(decodedToken) {
    if (!decodedToken.exp) {
        console.warn("Token does not have an 'exp' field.");
        return null;
    }

    const currentTime = Math.floor(Date.now() / 1000); // –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    const remainingTime = decodedToken.exp - currentTime;

    if (remainingTime <= 0) {
        console.warn("Token has already expired.");
        return 0;
    }

    return remainingTime; // –í —Å–µ–∫—É–Ω–¥–∞—Ö
}

// –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
function formatTime(seconds) {
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;

    return `${hours}—á ${minutes}–º ${secs}—Å`;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
            document.getElementById('loginRedirectButton').addEventListener('click', function () {
                window.location.href='/';});

             // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
             document.getElementById('openModalBtn').onclick = function() {
             initializeCheckboxes();
             document.getElementById('columnSelectModal').style.display = 'block';
            
             };
             window.addEventListener('resize', adjustContainerWidth); // –ü–æ–¥–≥–æ–Ω–∫–∞ —à–∏—Ä–∏–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞
           //   window.addEventListener('resize', adjustColumnWidths); // –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
              getAllUsers(); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–≥—Ä—É–∂–∞–µ–º 5 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞—á–∏–Ω–∞—è —Å 0            
              
             });
           

    </script>
</body>
</html>

