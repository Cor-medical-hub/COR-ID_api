
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <link rel="icon" type="image/png" href="/static/favicon.png">
        <!-- Другие метатеги и ссылки на иконки -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>User Records</title>
        <link rel="stylesheet" type="text/css" href="/static/styles.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
      
    </head>
    <body>
     <div class="container">
      <!--  <button class="link-button" onclick="goBack()" data-translate="back-link-text"><<<назад<<<</button>-->
     
        <div class="logo">  
            <svg width="100" height="30" viewBox="0 0 142 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_3177_20583)">
                <path d="M124.549 23.2737H113.901L129.188 45.2791H141.045L131.462 31.4543C136.968 28.8526 140.784 23.2446 140.784 16.7617C140.784 7.8078 133.502 0.522657 124.549 0.522657H102.311V45.2791H112.038V10.2511H124.549C128.141 10.2511 131.06 13.1709 131.06 16.7617C131.06 20.353 128.141 23.2737 124.549 23.2737Z" fill="#ED1064"/>
                <path d="M23.944 36.2649C16.632 36.2649 10.6815 30.3164 10.6797 23.0027L10.6668 22.9964L10.6797 22.9903C10.684 15.6765 16.632 9.72757 23.944 9.72757C27.5765 9.72757 30.8733 11.198 33.2712 13.5723L42.6554 9.6591C38.4829 3.81718 31.652 0 23.944 0C11.2677 0 0.95459 10.3163 0.95459 22.9964C0.95459 35.6767 11.2677 45.9929 23.944 45.9929C31.652 45.9929 38.4829 42.1748 42.6554 36.3334L33.2712 32.4216C30.8733 34.7955 27.5765 36.2649 23.944 36.2649Z" fill="#ED1064"/>
                <path d="M66.0385 15.649H62.954V30.3564H66.0385V15.649Z" fill="#7527B2"/>
                <path d="M79.8081 17.7289C78.4551 16.3422 76.737 15.6489 74.6535 15.6489H69.2758V30.3563H74.6535C76.737 30.3563 78.4551 29.663 79.8081 28.2763C81.1745 26.8756 81.8577 25.1107 81.8577 22.9816C81.8577 20.8525 81.1745 19.1016 79.8081 17.7289ZM77.5555 26.1542C76.7843 26.9806 75.79 27.3938 74.5724 27.3938H72.3603V18.6114H74.5724C75.79 18.6114 76.7843 19.0176 77.5555 19.83C78.3267 20.6424 78.7122 21.6929 78.7122 22.9816C78.7122 24.2703 78.3267 25.3277 77.5555 26.1542Z" fill="#7527B2"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M57.6496 30.1136C56.562 27.9792 55.9488 25.5626 55.9488 23.0027C55.9488 21.056 56.3199 19.2001 56.9681 17.4802L56.9515 17.4756C56.9515 17.4756 57.9286 12.1198 60.9689 8.00596C62.6904 5.67674 63.6183 4.67899 65.1869 3.24857C67.8529 0.8174 69.5436 0.132977 69.6361 0.096452C57.8705 1.10531 48.6337 10.9721 48.6337 23.0027C48.6337 28.9585 50.897 34.3854 54.6101 38.47C54.8796 38.7662 55.3627 38.6444 55.4726 38.2593L57.6884 30.5014C57.7255 30.372 57.7107 30.2335 57.6496 30.1136Z" fill="url(#paint0_linear_3177_20583)"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M73.1888 45.941C74.7854 45.2284 77.2915 43.6953 80.5784 40.3764C82.2496 38.6889 83.6227 36.3438 84.5411 34.095C85.266 32.3199 85.8022 30.332 86.135 28.9211C83.7992 34.6451 78.1863 38.6826 71.6239 38.6826C69.2727 38.6826 67.0425 38.1649 65.0409 37.237C64.9288 37.185 64.802 37.1727 64.6824 37.204L56.5743 39.3293C56.1797 39.4327 56.0521 39.9266 56.3568 40.1975C60.4171 43.8073 65.7646 46 71.6239 46C72.1504 46 72.6711 45.9759 73.1888 45.941Z" fill="url(#paint1_linear_3177_20583)"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M94.6144 23.0026C94.6144 10.3016 84.3213 0.0052998 71.624 0.0052998C70.9538 0.0052998 70.2919 0.0402436 69.6361 0.096452C69.5436 0.132977 67.8529 0.8174 65.1869 3.24857C63.6183 4.67899 62.6904 5.67674 60.9689 8.00596C57.9286 12.1198 56.9515 17.4756 56.9515 17.4756L56.9681 17.4802C59.2033 11.5493 64.913 7.32264 71.624 7.32264C80.2813 7.32264 87.2993 14.3428 87.2993 23.0026C87.2993 25.0981 86.8805 27.0939 86.135 28.9211C85.8021 30.332 84.9478 32.7517 84.0159 34.4274C83.2985 35.7174 82.5374 36.9624 81.7561 38.1017C80.9542 39.2708 80.1311 40.3286 79.312 41.2094C77.1791 43.503 74.7855 45.2283 73.1888 45.941C85.1554 45.1355 94.6144 35.177 94.6144 23.0026Z" fill="url(#paint2_linear_3177_20583)"/>
                </g>
                <defs>
                <linearGradient id="paint0_linear_3177_20583" x1="-12.4711" y1="40.4517" x2="-8.96669" y2="-1.59578" gradientUnits="userSpaceOnUse">
                <stop stop-color="#7527B2"/>
                <stop offset="1" stop-color="#AB77EB"/>
                </linearGradient>
                <linearGradient id="paint1_linear_3177_20583" x1="159.347" y1="17.8436" x2="50.6366" y2="-50.6245" gradientUnits="userSpaceOnUse">
                <stop stop-color="#7527B2"/>
                <stop offset="0.5" stop-color="#904FCF"/>
                <stop offset="1" stop-color="#AB77EB"/>
                </linearGradient>
                <linearGradient id="paint2_linear_3177_20583" x1="69.559" y1="-0.0967435" x2="86.0478" y2="47.3497" gradientUnits="userSpaceOnUse">
                <stop stop-color="#7527B2"/>
                <stop offset="0.5" stop-color="#7B43F2"/>
                <stop offset="1" stop-color="#AB77EB"/>
                </linearGradient>
                <clipPath id="clip0_3177_20583">
                <rect width="140.091" height="46" fill="white" transform="translate(0.95459)"/>
                </clipPath>
                </defs>
                </svg> <br>   
        </div>   
            <br> <h1 style=" margin-top:0; color:#291161;font-size: 18px; "  data-translate="welcome-message">Приветствуем в COR-ID</h1>
            <h4 id="userCorId" class="clickable" style=margin-top:0;>Загрузка...</h4>
            <div id="qrCodeContainer" style="display: none;margin-top: 10px;"></div> 
            <button class="button" id="passwordManagerButton">Password manager</button>
            <button class="button" id="Cor-Auth">COR-Auth</button>
            <button class="button" id="loginButton">COR-Platform</button>
            <div id="admin-button-container"></div> <!-- Контейнер для кнопки администратора -->
         <!-- Кнопка "Выйти" -->
            <button id="LogOut-btn" type="submit" class="button"> 
            <span data-translate="LogOut-button">Выйти</span>    
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g id="icon / for sections / exit" clip-path="url(#clip0_3512_133)">
                <g id="Vector">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M9.47058 0.147224C9.99184 -0.00914457 10.5424 
                -0.0414919 11.0784 0.052764C11.6144 0.14702 12.1209 0.365268 12.5576 0.690089C12.9942 1.01491 
                13.3488 1.43731 13.5932 1.92356C13.8376 2.40982 13.9649 2.94647 13.965 3.49067V20.5093C13.9649 
                21.0535 13.8376 21.5902 13.5932 22.0764C13.3488 22.5627 12.9942 22.9851 12.5576 23.3099C12.1209 
                23.6347 11.6144 23.853 11.0784 23.9472C10.5424 24.0415 9.99184 24.0091 9.47058 23.8528L2.48809 
                21.758C1.76901 21.5423 1.13862 21.1006 0.690431 20.4983C0.242239 19.896 0.000123112 19.1653 0 
                18.4146V5.58542C0.000123112 4.83468 0.242239 4.10398 0.690431 3.50171C1.13862 2.89944 1.76901 
                2.45768 2.48809 2.24197L9.47058 0.147224ZM15.1287 2.69001C15.1287 2.38137 15.2513 2.08536 15.4696 
                1.86712C15.6878 1.64887 15.9838 1.52627 16.2925 1.52627H19.7837C20.7097 1.52627 21.5977 1.89409 
                22.2524 2.54883C22.9071 3.20356 23.275 4.09157 23.275 5.01751V6.18126C23.275 6.4899 23.1524 
                6.78591 22.9341 7.00415C22.7159 7.2224 22.4199 7.34501 22.1112 7.34501C21.8026 7.34501 21.5066 
                7.2224 21.2883 7.00415C21.0701 6.78591 20.9475 6.4899 20.9475 6.18126V5.01751C20.9475 4.70887 
                20.8249 4.41286 20.6066 4.19462C20.3884 3.97637 20.0924 3.85376 19.7837 3.85376H16.2925C15.9838 
                3.85376 15.6878 3.73115 15.4696 3.51291C15.2513 3.29466 15.1287 2.99866 15.1287 2.69001ZM22.1112 
                16.655C22.4199 16.655 22.7159 16.7776 22.9341 16.9958C23.1524 17.2141 23.275 17.5101 23.275 
                17.8187V18.9825C23.275 19.9084 22.9071 20.7964 22.2524 21.4512C21.5977 22.1059 20.7097 22.4737 
                19.7837 22.4737H16.2925C15.9838 22.4737 15.6878 22.3511 15.4696 22.1329C15.2513 21.9146 15.1287 
                21.6186 15.1287 21.31C15.1287 21.0013 15.2513 20.7053 15.4696 20.4871C15.6878 20.2688 15.9838 
                20.1462 16.2925 20.1462H19.7837C20.0924 20.1462 20.3884 20.0236 20.6066 19.8054C20.8249 19.5871 
                20.9475 19.2911 20.9475 18.9825V17.8187C20.9475 17.5101 21.0701 17.2141 21.2883 16.9958C21.5066 
                16.7776 21.8026 16.655 22.1112 16.655ZM8.14624 10.8363C7.83759 10.8363 7.54159 10.9589 7.32334 
                11.1771C7.1051 11.3954 6.98249 11.6914 6.98249 12C6.98249 12.3086 7.1051 12.6046 7.32334 
                12.8229C7.54159 13.0411 7.83759 13.1637 8.14624 13.1637H8.1474C8.45605 13.1637 8.75205 13.0411 
                8.9703 12.8229C9.18854 12.6046 9.31115 12.3086 9.31115 12C9.31115 11.6914 9.18854 11.3954 8.9703 
                11.1771C8.75205 10.9589 8.45605 10.8363 8.1474 10.8363H8.14624Z" fill="white"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M19.1254 9.01443C19.489 8.65086 20.0785 8.65086 
                20.442 9.01443L22.7695 11.3419C23.1331 11.7055 23.1331 12.295 22.7695 12.6586L20.442 
                14.9861C20.0785 15.3496 19.489 15.3496 19.1254 14.9861C18.7618 14.6225 18.7618 14.033 19.1254 
                13.6694L19.8636 12.9312H16.2925C15.7783 12.9312 15.3615 12.5144 15.3615 12.0002C15.3615 11.4861 
                15.7783 11.0692 16.2925 11.0692H19.8636L19.1254 10.3311C18.7618 9.96749 18.7618 9.37801 19.1254 
                9.01443Z" fill="white"/>
                </g>
                </g>
                <defs>
                <clipPath id="clip0_3512_133">
                <rect width="24" height="24" fill="red"/>
                </clipPath>
                </defs>
              </svg>        
            </button>
    </div>
    <script src="/static/translation.js"></script>   
    <script> function goBack() { window.history.back();  } </script>
        <script>
           const accessToken = new URLSearchParams(window.location.search).get('access_token');
            console.log("accessToken from localStorage:", accessToken);
            document.getElementById('passwordManagerButton').addEventListener('click', function() {
                window.location.href = '/static/password_manager.html' + '?access_token=' + accessToken;
            });
    
            document.getElementById('Cor-Auth').addEventListener('click', function() {
                window.location.href = '/static/Cor-Id.html' + '?access_token=' + accessToken;
            });
    
            // Обработчик для кнопки "COR-Platform"
        document.getElementById('loginButton').addEventListener('click', function() {
            const accessToken = new URLSearchParams(window.location.search).get('access_token');
            const refreshToken = new URLSearchParams(window.location.search).get('refresh_token');
            const savedRedirectUrl = localStorage.getItem('redirectUrl');

            if (savedRedirectUrl && accessToken) {
                // Перенаправляем на savedRedirectUrl с access_token и cor_id
                window.location.href = `${savedRedirectUrl}?access_token=${accessToken}&refresh_token=${refreshToken}`;
            } else {
                console.error("Ошибка: Не найдены параметры redirect_url или cor_id.");
            }
        });




        document.getElementById('LogOut-btn').addEventListener('click', function () {
                // Удаление токенов из localStorage
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                localStorage.removeItem('isAdmin');
                localStorage.removeItem('redirectUrl');


                // Очистка кэша страницы
                if ('caches' in window) {
                    caches.keys().then(names => {
                        for (let name of names) caches.delete(name);
                    });
                }

                    // Переадресация на страницу login.html
                    window.location.href = '/';
                });


            function toggleQrCode(corId) {
                const qrCodeContainer = document.getElementById('qrCodeContainer');

                if (qrCodeContainer.style.display === 'block') {
                    // Скрываем QR-код, если он уже отображается
                    qrCodeContainer.style.display = 'none';
                    qrCodeContainer.innerHTML = ''; // Очищаем контейнер
                } else {
                    // Показываем QR-код
                    qrCodeContainer.style.display = 'block';

                    // Очищаем предыдущий QR-код (если есть)
                    qrCodeContainer.innerHTML = '';

                    // Генерация нового QR-кода
                    new QRCode(qrCodeContainer, {
                        text: corId,
                        width: 160,
                        height: 160
                    });
                }
            }
            async function fetchCorId() {
                const accessToken = new URLSearchParams(window.location.search).get('access_token');
                if (!accessToken) {
                    console.error("Токен доступа не найден.");
                    document.getElementById('userCorId').textContent = "Ошибка: токен не найден.";
                    return;
                }

                try {
                    const response = await fetch('/api/user/my_core_id', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error("Ошибка получения COR-ID:", errorData);
                        document.getElementById('userCorId').textContent = "Ошибка получения COR-ID.";
                        return;
                    }

                    const corId = await response.json();
                    const userCorIdElement = document.getElementById('userCorId');
                    userCorIdElement.textContent = `${corId}`;
                     // Jбработчик клика для отображения QR-кода
                     userCorIdElement.addEventListener('click', () => toggleQrCode(corId));
                     // Jбработчик клика на сам QR-код для его скрытия
                    const qrCodeContainer = document.getElementById('qrCodeContainer');
                    qrCodeContainer.addEventListener('click', () => {
                        qrCodeContainer.style.display = 'none'; // Скрываем QR-код
                        qrCodeContainer.innerHTML = ''; // Очищаем контейнер
                    });
                } catch (error) {
                    console.error("Ошибка при запросе COR-ID:", error);
                    document.getElementById('userCorId').textContent = "Ошибка при загрузке COR-ID.";
                }
            }

            document.addEventListener('DOMContentLoaded', fetchCorId);
            document.addEventListener('DOMContentLoaded', function() {
          const isAdmin = localStorage.getItem('isAdmin'); // Получаем значение из localStorage
          const adminButtonContainer = document.getElementById('admin-button-container'); // Элемент, куда будет добавлена кнопка
              // Логирование значения isAdmin
            console.log("isAdmin from localStorage:", isAdmin); // Логируем значение
            if (isAdmin === 'true') { // Проверяем, является ли пользователь администратором
                const adminButton = document.createElement('button');
                adminButton.innerText = 'Администрирование';
                adminButton.className = 'admin-button'; 
                adminButton.onclick = function() {
                    window.location.href =  `/static/admin.html/?access_token=${accessToken}`// Переход на страницу администрирования
                   
                };
                adminButtonContainer.appendChild(adminButton); // Добавляем кнопку в контейнер
            }

        });
        </script>
    </body>
    </html>
    