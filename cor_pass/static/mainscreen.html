
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <link rel="icon" type="image/png" href="/static/favicon.png">
        <!-- Другие метатеги и ссылки на иконки -->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>User Records</title>
        <link rel="stylesheet" type="text/css" href="/static/styles.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
      
    </head>
    <body>
     <div class="container">
      <!--  <button class="link-button" onclick="goBack()" data-translate="back-link-text"><<<назад<<<</button>-->

        <div class="logo">
   
            <svg width="100" height="30" viewBox="0 0 142 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_3177_20583)">
                <path d="M124.549 23.2737H113.901L129.188 45.2791H141.045L131.462 31.4543C136.968 28.8526 140.784 23.2446 140.784 16.7617C140.784 7.8078 133.502 0.522657 124.549 0.522657H102.311V45.2791H112.038V10.2511H124.549C128.141 10.2511 131.06 13.1709 131.06 16.7617C131.06 20.353 128.141 23.2737 124.549 23.2737Z" fill="#ED1064"/>
                <path d="M23.944 36.2649C16.632 36.2649 10.6815 30.3164 10.6797 23.0027L10.6668 22.9964L10.6797 22.9903C10.684 15.6765 16.632 9.72757 23.944 9.72757C27.5765 9.72757 30.8733 11.198 33.2712 13.5723L42.6554 9.6591C38.4829 3.81718 31.652 0 23.944 0C11.2677 0 0.95459 10.3163 0.95459 22.9964C0.95459 35.6767 11.2677 45.9929 23.944 45.9929C31.652 45.9929 38.4829 42.1748 42.6554 36.3334L33.2712 32.4216C30.8733 34.7955 27.5765 36.2649 23.944 36.2649Z" fill="#ED1064"/>
                <path d="M66.0385 15.649H62.954V30.3564H66.0385V15.649Z" fill="#7527B2"/>
                <path d="M79.8081 17.7289C78.4551 16.3422 76.737 15.6489 74.6535 15.6489H69.2758V30.3563H74.6535C76.737 30.3563 78.4551 29.663 79.8081 28.2763C81.1745 26.8756 81.8577 25.1107 81.8577 22.9816C81.8577 20.8525 81.1745 19.1016 79.8081 17.7289ZM77.5555 26.1542C76.7843 26.9806 75.79 27.3938 74.5724 27.3938H72.3603V18.6114H74.5724C75.79 18.6114 76.7843 19.0176 77.5555 19.83C78.3267 20.6424 78.7122 21.6929 78.7122 22.9816C78.7122 24.2703 78.3267 25.3277 77.5555 26.1542Z" fill="#7527B2"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M57.6496 30.1136C56.562 27.9792 55.9488 25.5626 55.9488 23.0027C55.9488 21.056 56.3199 19.2001 56.9681 17.4802L56.9515 17.4756C56.9515 17.4756 57.9286 12.1198 60.9689 8.00596C62.6904 5.67674 63.6183 4.67899 65.1869 3.24857C67.8529 0.8174 69.5436 0.132977 69.6361 0.096452C57.8705 1.10531 48.6337 10.9721 48.6337 23.0027C48.6337 28.9585 50.897 34.3854 54.6101 38.47C54.8796 38.7662 55.3627 38.6444 55.4726 38.2593L57.6884 30.5014C57.7255 30.372 57.7107 30.2335 57.6496 30.1136Z" fill="url(#paint0_linear_3177_20583)"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M73.1888 45.941C74.7854 45.2284 77.2915 43.6953 80.5784 40.3764C82.2496 38.6889 83.6227 36.3438 84.5411 34.095C85.266 32.3199 85.8022 30.332 86.135 28.9211C83.7992 34.6451 78.1863 38.6826 71.6239 38.6826C69.2727 38.6826 67.0425 38.1649 65.0409 37.237C64.9288 37.185 64.802 37.1727 64.6824 37.204L56.5743 39.3293C56.1797 39.4327 56.0521 39.9266 56.3568 40.1975C60.4171 43.8073 65.7646 46 71.6239 46C72.1504 46 72.6711 45.9759 73.1888 45.941Z" fill="url(#paint1_linear_3177_20583)"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M94.6144 23.0026C94.6144 10.3016 84.3213 0.0052998 71.624 0.0052998C70.9538 0.0052998 70.2919 0.0402436 69.6361 0.096452C69.5436 0.132977 67.8529 0.8174 65.1869 3.24857C63.6183 4.67899 62.6904 5.67674 60.9689 8.00596C57.9286 12.1198 56.9515 17.4756 56.9515 17.4756L56.9681 17.4802C59.2033 11.5493 64.913 7.32264 71.624 7.32264C80.2813 7.32264 87.2993 14.3428 87.2993 23.0026C87.2993 25.0981 86.8805 27.0939 86.135 28.9211C85.8021 30.332 84.9478 32.7517 84.0159 34.4274C83.2985 35.7174 82.5374 36.9624 81.7561 38.1017C80.9542 39.2708 80.1311 40.3286 79.312 41.2094C77.1791 43.503 74.7855 45.2283 73.1888 45.941C85.1554 45.1355 94.6144 35.177 94.6144 23.0026Z" fill="url(#paint2_linear_3177_20583)"/>
                </g>
                <defs>
                <linearGradient id="paint0_linear_3177_20583" x1="-12.4711" y1="40.4517" x2="-8.96669" y2="-1.59578" gradientUnits="userSpaceOnUse">
                <stop stop-color="#7527B2"/>
                <stop offset="1" stop-color="#AB77EB"/>
                </linearGradient>
                <linearGradient id="paint1_linear_3177_20583" x1="159.347" y1="17.8436" x2="50.6366" y2="-50.6245" gradientUnits="userSpaceOnUse">
                <stop stop-color="#7527B2"/>
                <stop offset="0.5" stop-color="#904FCF"/>
                <stop offset="1" stop-color="#AB77EB"/>
                </linearGradient>
                <linearGradient id="paint2_linear_3177_20583" x1="69.559" y1="-0.0967435" x2="86.0478" y2="47.3497" gradientUnits="userSpaceOnUse">
                <stop stop-color="#7527B2"/>
                <stop offset="0.5" stop-color="#7B43F2"/>
                <stop offset="1" stop-color="#AB77EB"/>
                </linearGradient>
                <clipPath id="clip0_3177_20583">
                <rect width="140.091" height="46" fill="white" transform="translate(0.95459)"/>
                </clipPath>
                </defs>
                </svg> <br>
                
    
    
        </div>   
        <div class="top-panel">
        <div class="panel">
            <br> <h1 style=" margin-top:0; color:#291161;font-size: 18px; ">Приветствуем в COR-ID</h1>
            <h4 id="userCorId" class="clickable" style=margin-top:0;>Загрузка...</h4>
            <div id="qrCodeContainer" style="display: none;margin-top: 10px;"></div> 
            <button class="button" id="passwordManagerButton">Password manager</button>
            <button class="button" id="Cor-Auth">COR-Auth</button>
            <button class="button" id="loginButton">COR-Platform</button>
        </div>
        <div id="admin-button-container"></div> <!-- Контейнер для кнопки администратора -->
         <!-- Кнопка "Выйти" -->
         <button id="LogOut-btn" class="link-button" style="color: #e60f0f;" data-translate="LogOut-button">Выйти</button>
    </div>
    </div>
    <script src="/static/translation.js"></script>   
    <script> function goBack() { window.history.back();  } </script>
        <script>
           const accessToken = new URLSearchParams(window.location.search).get('access_token');
            console.log("accessToken from localStorage:", accessToken);
            document.getElementById('passwordManagerButton').addEventListener('click', function() {
                window.location.href = '/static/password_manager.html' + '?access_token=' + accessToken;
            });
    
            document.getElementById('Cor-Auth').addEventListener('click', function() {
                window.location.href = '/static/Cor-Id.html' + '?access_token=' + accessToken;
            });
    
            // Обработчик для кнопки "COR-Platform"
        document.getElementById('loginButton').addEventListener('click', function() {
            const accessToken = new URLSearchParams(window.location.search).get('access_token');
            const refreshToken = new URLSearchParams(window.location.search).get('refresh_token');
            const savedRedirectUrl = localStorage.getItem('redirectUrl');

            if (savedRedirectUrl && accessToken) {
                // Перенаправляем на savedRedirectUrl с access_token и cor_id
                window.location.href = `${savedRedirectUrl}?access_token=${accessToken}&refresh_token=${refreshToken}`;
            } else {
                console.error("Ошибка: Не найдены параметры redirect_url или cor_id.");
            }
        });




        document.getElementById('LogOut-btn').addEventListener('click', function () {
                // Удаление токенов из localStorage
                localStorage.removeItem('accessToken');
                localStorage.removeItem('refreshToken');
                localStorage.removeItem('isAdmin');
                localStorage.removeItem('redirectUrl');


                // Очистка кэша страницы
                if ('caches' in window) {
                    caches.keys().then(names => {
                        for (let name of names) caches.delete(name);
                    });
                }

                    // Переадресация на страницу login.html
                    window.location.href = '/';
                });


            function toggleQrCode(corId) {
                const qrCodeContainer = document.getElementById('qrCodeContainer');

                if (qrCodeContainer.style.display === 'block') {
                    // Скрываем QR-код, если он уже отображается
                    qrCodeContainer.style.display = 'none';
                    qrCodeContainer.innerHTML = ''; // Очищаем контейнер
                } else {
                    // Показываем QR-код
                    qrCodeContainer.style.display = 'block';

                    // Очищаем предыдущий QR-код (если есть)
                    qrCodeContainer.innerHTML = '';

                    // Генерация нового QR-кода
                    new QRCode(qrCodeContainer, {
                        text: corId,
                        width: 160,
                        height: 160
                    });
                }
            }
            async function fetchCorId() {
                const accessToken = new URLSearchParams(window.location.search).get('access_token');
                if (!accessToken) {
                    console.error("Токен доступа не найден.");
                    document.getElementById('userCorId').textContent = "Ошибка: токен не найден.";
                    return;
                }

                try {
                    const response = await fetch('/api/user/my_core_id', {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error("Ошибка получения COR-ID:", errorData);
                        document.getElementById('userCorId').textContent = "Ошибка получения COR-ID.";
                        return;
                    }

                    const corId = await response.json();
                    const userCorIdElement = document.getElementById('userCorId');
                    userCorIdElement.textContent = `${corId}`;
                     // Jбработчик клика для отображения QR-кода
                     userCorIdElement.addEventListener('click', () => toggleQrCode(corId));
                     // Jбработчик клика на сам QR-код для его скрытия
                    const qrCodeContainer = document.getElementById('qrCodeContainer');
                    qrCodeContainer.addEventListener('click', () => {
                        qrCodeContainer.style.display = 'none'; // Скрываем QR-код
                        qrCodeContainer.innerHTML = ''; // Очищаем контейнер
                    });
                } catch (error) {
                    console.error("Ошибка при запросе COR-ID:", error);
                    document.getElementById('userCorId').textContent = "Ошибка при загрузке COR-ID.";
                }
            }

            document.addEventListener('DOMContentLoaded', fetchCorId);
            document.addEventListener('DOMContentLoaded', function() {
          const isAdmin = localStorage.getItem('isAdmin'); // Получаем значение из localStorage
          const adminButtonContainer = document.getElementById('admin-button-container'); // Элемент, куда будет добавлена кнопка
              // Логирование значения isAdmin
            console.log("isAdmin from localStorage:", isAdmin); // Логируем значение
            if (isAdmin === 'true') { // Проверяем, является ли пользователь администратором
                const adminButton = document.createElement('button');
                adminButton.innerText = 'Администрирование';
                adminButton.className = 'admin-button'; 
                adminButton.onclick = function() {
                    window.location.href =  `/static/admin.html/?access_token=${accessToken}`// Переход на страницу администрирования
                   
                };
                adminButtonContainer.appendChild(adminButton); // Добавляем кнопку в контейнер
            }

        });
        </script>
    </body>
    </html>
    